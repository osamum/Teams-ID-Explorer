let state={dataStore:{},storeKey:"",previouseSelectedItem:null,previouseFeatureViewItemKey:"",currentResource:"",accessToken:"",captions:{}};const parentEndpointOf={teams:"https://graph.microsoft.com/v1.0/teams/",chats:"https://graph.microsoft.com/v1.0/me/chats/",joinTeams:"https://graph.microsoft.com/v1.0/me/joinedTeams"},HTTP_METHOD={GET:"GET",POST:"POST",PATCH:"PATCH",PUT:"PUT",DELETE:"DELETE"},RESOURCE_TYPE={TEAMs:"teams",TEAM:"team",CHANNELs:"channels",CHANNEL:"channel",CHATs:"chats",CHAT:"chat",MEMBERs:"members",MEMBER:"member",MESSAGEs:"messages",MESSAGE:"message",STRAGE:"filesFolder",DRIVE:"drive",FOLDERs:"root/children",ITEM:"items",ITEM_CHILDREN:"children"},docsUrl={base:"https://learn.microsoft.com/ja-jp/graph/api/",teams:"user-list-joinedteams",team:"team",channels:"channel-list",channel:"channel-get",filesFolder:"channel-get-filesfolder",chats:"chat-list",chat:"chat-get",members:"channel-list-members",messages:"channel-list-messages",drive:"drive-get",items:"driveitem-list-children",children:"driveitem-list-children",member:"user-get"};function markSelected(element){state.previouseSelectedItem&&(state.previouseSelectedItem.className=""),element.className="selectedItem",state.previouseSelectedItem=element}function getTeamList(accessToken){state.currentResource=RESOURCE_TYPE.TEAMs,setReferenceLink();const ENDPOINT_TEAMLIST=parentEndpointOf.joinTeams;callGraphAPI(HTTP_METHOD.GET,ENDPOINT_TEAMLIST,"",accessToken).then(data=>{const teamListJson=JSON.stringify(data,null,3);state.dataStore.joinedTeams=teamListJson,state.storeKey="joinedTeams",responseView.innerText=teamListJson,httpTabEventHandler(httpTab.activeTabIndex);let ul=document.createElement("ul");ul.style.display="block";for(const item of data.value){let li=document.createElement("li");displayTeamImg(item.id,li),li.setAttribute("data-res-id",item.id),li.setAttribute("title",item.description),li.innerText=item.displayName,li.onclick=event=>{state.currentResource=RESOURCE_TYPE.TEAM,setReferenceLink();const element=event.target;markSelected(element);const teamId=element.getAttribute("data-res-id"),endpoint=parentEndpointOf.teams+teamId;if(state.dataStore[teamId]?(responseView.innerText=state.dataStore[teamId],reqEndpoint.value=endpoint):GetShowTeamsResInfo(teamId,endpoint,accessToken),element.children.length>1){const childTree=element.children[1];"block"==childTree.style.display?(childTree.style.display="none",state.storeKey=teamId):(state.storeKey=`${teamId}/channels`,childTree.style.display="block",reqEndpoint.value=`${endpoint}/channels`),httpTabEventHandler(httpTab.activeTabIndex)}else getChannelList(element,teamId,accessToken);event.stopPropagation()},ul.appendChild(li)}treeView.appendChild(ul)})}function getChannelList(parentLi,teamId,accessToken){const ENDPOINT_CANNELLIST=`https://graph.microsoft.com/v1.0/teams/${teamId}/channels`;parentLi.style.cursor="wait",callGraphAPI(HTTP_METHOD.GET,ENDPOINT_CANNELLIST,"",accessToken).then(data=>{const responsedJson=JSON.stringify(data,null,3);responseView.innerText=responsedJson,state.currentResource=RESOURCE_TYPE.CHANNELs,state.storeKey=`${teamId}/channels`,state.dataStore[state.storeKey]=responsedJson,setReferenceLink(),httpTabEventHandler(httpTab.activeTabIndex);let ul=document.createElement("ul");ul.style.display="block";for(const item of data.value){let li=document.createElement("li");li.setAttribute("data-res-id",item.id),li.setAttribute("title",item.description),li.innerText=item.displayName,li.style.listStyleImage="none",li.onclick=event=>{const element=event.target;markSelected(element);const channelId=element.getAttribute("data-res-id"),endpoint=`${ENDPOINT_CANNELLIST}/${channelId}`;state.currentResource=RESOURCE_TYPE.CHANNEL,state.storeKey=channelId,setReferenceLink(),state.dataStore[channelId]?(reqEndpoint.value=endpoint,responseView.innerText=state.dataStore[channelId]):GetShowTeamsResInfo(channelId,endpoint,accessToken),event.stopPropagation()},li.appendChild(createChannelChildren(`${teamId}/channels/${item.id}`,accessToken,parentEndpointOf.teams)),ul.appendChild(li)}parentLi.appendChild(ul),parentLi.style.cursor="pointer"})}function createChannelChildren(id,accessToken,parentEndpoint){const endpointSwitch=[{key:"members",displayName:state.captions.members},{key:"messages",displayName:state.captions.messages},{key:"filesFolder",displayName:state.captions.filesFolder}],chatReference=["chat-list-members","chat-list-messages"],ul=document.createElement("ul"),loopMax=parentEndpoint==parentEndpointOf.teams?2:1;ul.style.display="block";for(let cnt=0;cnt<=loopMax;cnt++){const li=document.createElement("li");li.innerText=endpointSwitch[cnt].displayName,li.setAttribute("data-res-id",`${id}/${endpointSwitch[cnt].key}`),li.onclick=event=>{const element=event.target,endpointId=element.getAttribute("data-res-id"),dataStoreKey=endpointId.replaceAll("/","-");state.currentResource=getCurrentResource(endpointId),state.storeKey=dataStoreKey,1==loopMax?setReferenceLink(chatReference[cnt]):setReferenceLink(),markSelected(element),element.style.cursor="wait",callGraphAPI(HTTP_METHOD.GET,parentEndpoint+endpointId,"",accessToken).then(data=>{const responsedJson=JSON.stringify(data,null,3);state.dataStore[dataStoreKey]=responsedJson,element.style.cursor="pointer",responseView.innerText=responsedJson,httpTabEventHandler(httpTab.activeTabIndex)}),event.stopPropagation()},ul.appendChild(li)}return ul}function getChatList(accessToken){const ENDPOINT_CHATLIST="https://graph.microsoft.com/v1.0/me/chats";state.currentResource=RESOURCE_TYPE.CHATs,state.storeKey="chats",setReferenceLink(),callGraphAPI(HTTP_METHOD.GET,ENDPOINT_CHATLIST,"",accessToken).then(data=>{const responsedJson=JSON.stringify(data,null,3);responseView.innerText=responsedJson,state.dataStore.chats=responsedJson;let ul=document.createElement("ul");ul.style.display="block";for(const item of data.value){state.dataStore[item.id]=JSON.stringify(item,null,3);let li=document.createElement("li");li.setAttribute("data-res-id",item.id),li.setAttribute("title",item.chatType),li.innerText=item.topic?item.topic:"Untitled",li.onclick=event=>{const element=event.target;markSelected(element);const endpoint=element.getAttribute("data-res-id");responseView.innerText=state.dataStore[endpoint],state.currentResource=RESOURCE_TYPE.CHAT,state.storeKey=endpoint,setReferenceLink(),httpTabEventHandler(httpTab.activeTabIndex),element.children[0].style.display="block"==element.children[0].style.display?"none":"block",event.stopPropagation()};const child_ui=createChannelChildren(item.id,accessToken,parentEndpointOf.chats);child_ui.style.display="none",li.appendChild(child_ui),ul.appendChild(li)}chatListView.appendChild(ul)})}function GetShowTeamsResInfo(resourceId,endpoint,accessToken){callGraphAPI(HTTP_METHOD.GET,endpoint,"",accessToken).then(data=>{const responsedJson=JSON.stringify(data,null,3);state.dataStore[resourceId]=responsedJson,responseView.innerText=responsedJson,httpTabEventHandler(httpTab.activeTabIndex)})}function getMemberProfile(userId){const endpoint=`https://graph.microsoft.com/v1.0/users/${userId}`;getOtherResourceInfo(userId,endpoint),state.currentResource=RESOURCE_TYPE.MEMBER,setReferenceLink()}function getDriveInfo(driveId){const endpoint=`https://graph.microsoft.com/v1.0/drives/${driveId}`;getOtherResourceInfo(driveId,endpoint),state.currentResource=RESOURCE_TYPE.DRIVE,setReferenceLink()}function getFolderList(driveId){const endpoint=`https://graph.microsoft.com/v1.0/drives/${driveId}/root/children`;getOtherResourceInfo(driveId,endpoint),state.currentResource=RESOURCE_TYPE.FOLDERs,setReferenceLink()}function getDriveItem(driveId,itemId){const endpoint=`https://graph.microsoft.com/v1.0/drives/${driveId}/items/${itemId}`;getOtherResourceInfo(`${driveId}-${itemId}`,endpoint),state.currentResource=RESOURCE_TYPE.ITEM,setReferenceLink()}function getDriveItemChildren(driveId,itemId){const endpoint=`https://graph.microsoft.com/v1.0/drives/${driveId}/items/${itemId}/children`;getOtherResourceInfo(`${driveId}-${itemId}-children`,endpoint),state.currentResource=RESOURCE_TYPE.ITEM_CHILDREN,setReferenceLink()}function getOtherResourceInfo(resourceId,endpoint){callGraphAPI(HTTP_METHOD.GET,endpoint,"",state.accessToken).then(data=>{const responsedJson=JSON.stringify(data,null,3);state.dataStore[resourceId]=responsedJson,responseView.innerText=responsedJson,httpTab.tabSelecter(0),state.storeKey=resourceId})}async function showResourcePicture(endpoint){const headers=new Headers,bearer=`Bearer ${state.accessToken}`;headers.append("Authorization",bearer);const options={method:HTTP_METHOD.GET,headers:headers};return await fetch(endpoint,options)}async function callGraphAPI(httpMethod,endpoint,reqBody,token){reqMethod.innerText=httpMethod,reqEndpoint.value=endpoint,reqEndpoint.title=endpoint;const headers=new Headers,bearer=`Bearer ${token}`;headers.append("Authorization",bearer),headers.append("Content-Type","application/json");const options={method:httpMethod,headers:headers};reqBody?options.body=reqBody:requestView.innerText="";const res=await fetch(endpoint,options);return res.json()}function getCurrentResource(endpoint){return endpoint.split("/").at(-1)}
