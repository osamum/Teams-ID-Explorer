window.onload=()=>{sessionStorage.clear()};const $id=id=>document.getElementById(id),loginedArea=$id("loginedArea"),beforeLogineArea=$id("beforeLogineArea"),treeTab=$id("treeTab"),httpTab=$id("httpTab"),treeView=$id("treeView"),chatListView=$id("chatListView"),reqEndpoint=$id("reqEndpoint"),reqMethod=$id("reqMethod"),requestView=$id("innerRequestView"),responseView=$id("innerResponseView"),accountInfo=$id("accountInfo"),copyButton=$id("copyButton"),formatedArea=$id("formated_area"),messageForm=$id("messageForm"),messageEditor=$id("messageEditor"),sendGraphExpButton=$id("sendGraphExpButton"),referenceLink=$id("referenceLink");function signOn(){logon().then(response=>{loadData(response.accessToken)}).catch(error=>error.message.indexOf("AADSTS65001")?(alert(_localize.getDefinedValue("azureADpopup","message")),void window.open("https://portal.azure.com/#view/Microsoft_AAD_IAM/StartboardApplicationsMenuBlade/~/AppAppsPreview/menuId/","_blank")):error instanceof msal.InteractionRequiredAuthError?myMSALObj.acquireTokenPopup(tokenRequest).then(tokenResponse=>{console.log(tokenResponse),loadData(tokenResponse.accessToken)}).catch(error=>{console.error(error)}):void console.log(error))}function loadData(accessToken){state.accessToken=accessToken,showItem(`Bearer ${accessToken}`),getTeamList(accessToken),treeTab.onTabClick=index=>{1==index&&0==chatListView.children.length&&(chatListView.style.cursor="wait",httpTab.tabSelecter(0),getChatList(accessToken),chatListView.style.cursor="auto")},httpTab.onTabClick=httpTabEventHandler}function httpTabEventHandler(index){if(1==index){if(state.previouseFeatureViewItemKey==state.storeKey)return;formatedArea.children.length>0&&homeCook.deleteChildrenNodeAll(formatedArea);const data=JSON.parse(state.dataStore[state.storeKey]),cssClassNames={table:"propertyTable",tr:"",tdName:"tdName",tdValue:"tdValue"};let featureSetting={webUrl:{innerHTML:'<a href="@value" target="blank">@value</a>'}};switch(state.currentResource){case RESOURCE_TYPE.MEMBERs:featureSetting.userId={innerHTML:"<a href=\"javaScript:getMemberProfile('@value')\" >@value</a>"};break;case RESOURCE_TYPE.MEMBER:featureSetting.id={innerHTML:"@value <a href=\"javaScript:showProfilePicture('@value')\">ðŸ–¼</a>",title:state.captions.usersPicture};break;case RESOURCE_TYPE.CHAT:featureSetting.joinWebUrl={innerHTML:'<a href="@value" target="blank">@value</a>'},featureSetting.child={id:{innerHTML:"<a href=\"javaScript:getMemberProfile('@value')\">@value</a>",title:state.captions.chatId},joinWebUrl:{innerHTML:'<a href="@value" target="blank">@value</a>',title:state.captions.joinWebUrl}};break;case RESOURCE_TYPE.STRAGE:case RESOURCE_TYPE.ITEM:featureSetting.child={driveId:{innerHTML:"<a href=\"javaScript:getDriveInfo('@value')\">@value</a>",title:state.captions.driveId},childCount:{id:`afterWork_${data.id}`,title:state.captions.childCount,innerText:"@value"}}}if(data.value){const headerObj={"@odata.context":data["@odata.context"],"@odata.count":data["@odata.count"]};if(data["@odata.nextLink"]&&(headerObj["@odata.nextLink"]=data["@odata.nextLink"]),formatedArea.appendChild(homeCook.tableParse(headerObj,cssClassNames)),state.currentResource==RESOURCE_TYPE.MESSAGEs){const button=document.createElement("button");button.innerText="â–¶âœ‰",button.title="Post new message.",button.addEventListener("click",()=>{messageForm.showModal()}),formatedArea.appendChild(button)}let counter=0;for(const message of data.value){const h2=document.createElement("h2");if(h2.innerText=`value[${counter}]`,formatedArea.appendChild(h2),state.currentResource==RESOURCE_TYPE.FOLDERs?(featureSetting.id={innerHTML:`<a href="javaScript:getDriveItem('${state.storeKey}','@value')">@value</a>`,title:state.captions.foldersId},featureSetting.child={childCount:{id:`afterWork_${message.id}`,title:state.captions.childCount,innerText:"@value"}}):state.currentResource==RESOURCE_TYPE.ITEM_CHILDREN?(featureSetting["@microsoft.graph.downloadUrl"]={innerHTML:'<a href="@value" target="blank">@value</a>'},featureSetting.driveId={innerHTML:"<a href=\"javaScript:getDriveInfo('@value')\">@value</a>",title:state.captions.driveId}):state.currentResource==RESOURCE_TYPE.CHATs&&(featureSetting.child={joinWebUrl:{innerHTML:'<a href="@value" target="blank">@value</a>',title:state.captions.joinWebUrl}}),formatedArea.appendChild(homeCook.tableParse(message,cssClassNames,featureSetting)),state.currentResource==RESOURCE_TYPE.FOLDERs){const childCountElement=$id(`afterWork_${message.id}`);if(Number(childCountElement.innerText)>0){const childCount=childCountElement.innerText;childCountElement.innerHTML=`<a href="javaScript:getDriveItemChildren('${message.parentReference.driveId}','${message.id}')">${childCount}</a>`,childCountElement.style.fontWeight="bold"}}counter++}}else if(formatedArea.appendChild(homeCook.tableParse(data,cssClassNames,featureSetting)),state.currentResource==RESOURCE_TYPE.STRAGE||state.currentResource==RESOURCE_TYPE.ITEM){const childCountElement=$id(`afterWork_${data.id}`);if(Number(childCountElement.innerText)>0){const childCount=childCountElement.innerText;state.currentResource==RESOURCE_TYPE.STRAGE?childCountElement.innerHTML=`<a href="javaScript:getFolderList('${data.parentReference.driveId}')">${childCount}</a>`:childCountElement.innerHTML=`<a href="javaScript:getDriveItemChildren('${data.parentReference.driveId}','${data.id}')">${childCount}</a>`,childCountElement.style.fontWeight="bold"}}state.previouseFeatureViewItemKey=state.storeKey}}function showProfilePicture(userId){if($id(state.storeKey))return;const endpoint=`https://graph.microsoft.com/v1.0/users/${userId}/photo/$value`;showResourcePicture(endpoint).then(data=>{homeCook.imgURLfromStream(data.body,endpoint,renderProfilePicture)})}function displayTeamImg(teamId,element){const endpoint=parentEndpointOf.teams+teamId+"/photo/$value",callback=(endpoint,url)=>{element.style.listStyleType="none";const img=document.createElement("img");img.src=url,img.title="GET "+endpoint,img.style.width="20px",img.style.height="20px",img.style.marginRight="5px",img.setAttribute("align","left"),img.onclick=event=>{sendGraphExporer("GET",endpoint),event.stopPropagation()},element.appendChild(img)};showResourcePicture(endpoint).then(data=>{homeCook.imgURLfromStream(data.body,endpoint,callback)})}function showItem(text){let elm=document.createElement("div");elm.innerText=text,accountInfo.appendChild(elm)}function flip_flopDisplay(ctrl1,ctrl2){ctrl1.style.display=ctrl2.style.display,ctrl2.style.display="none"===ctrl2.style.display?"block":"none"}function showPropertyName_and_Value(objInfo){for(var prop in objInfo)showItem(`${prop} : ${objInfo[prop]}`)}function showProfileDialog(){accountInfo.showModal()}async function sendClipboard(text){try{await navigator.clipboard.writeText(text),alert(state.captions.copyOK)}catch(error){alert(error&&error.message||state.captions.copyError)}}function sendGraphExporer(httpMethod,endPoint){const startPoint="https://graph.microsoft.com/v1.0/".length,href=`https://developer.microsoft.com/ja-jp/graph/graph-explorer?request=${endPoint=encodeURIComponent(endPoint.substring(startPoint,endPoint.length))}&method=${httpMethod}&version=v1.0&GraphUrl=https://graph.microsoft.com`;window.open(href)}function setReferenceLink(directoryName){const url=directoryName?docsUrl.base+directoryName:docsUrl.base+docsUrl[state.currentResource];referenceLink.href=url}function renderProfilePicture(endpoint,imgSrc){const bindData={endpoint:endpoint,sendClipboard:()=>{sendClipboard(endpoint)},sendGraphExp:()=>{sendGraphExporer("GET",endpoint)},docsUrl:docsUrl.base+"profilephoto-get",imgSrc:imgSrc};homeCook.DOMTemplate.bindTemplate(formatedArea,bindData)}formatedArea.setAttribute("data-template","profilePictureUI"),_localize.setAttributeDefinedValue("logOnButton","innerText"),_localize.setAttributeDefinedValue("logOffButton","innerText"),_localize.setAttributeDefinedValue("showAccountInfo","innerText"),treeTab.tabAllay[0].tab.innerText=_localize.getDefinedValue("teamTab","caption"),treeTab.tabAllay[1].tab.innerText=_localize.getDefinedValue("chatTab","caption"),state.captions.usersPicture=_localize.getDefinedValue("usersPicture","title"),state.captions.chatId=_localize.getDefinedValue("chatId","title"),state.captions.joinWebUrl=_localize.getDefinedValue("joinWebUrl","title"),state.captions.driveId=_localize.getDefinedValue("driveId","title"),state.captions.childCount=_localize.getDefinedValue("childCount","title"),state.captions.foldersId=_localize.getDefinedValue("foldersId","title"),state.captions.members=_localize.getDefinedValue("members","displayName"),state.captions.messages=_localize.getDefinedValue("messages","displayName"),state.captions.filesFolder=_localize.getDefinedValue("filesFolder","displayName"),state.captions.copyOK=_localize.getDefinedValue("messgeCopy","successful"),state.captions.copyError=_localize.getDefinedValue("messgeCopy","failed"),$id("cancelMessage").addEventListener("click",e=>{messageEditor.innerHTML="",messageForm.close()}),$id("postMessage").addEventListener("click",e=>{const requestBody=`{\n        "from": {\n            "user": {\n                "id": "${state.currentAccoutInfo.localAccountId}",\n                "displayName": "${state.currentAccoutInfo.name}",\n                "userIdentityType": "aadUser"\n            }\n        },\n        "body": {\n            "contentType": "html",\n            "content": "${messageEditor.innerHTML}"\n        }\n    }`;requestView.innerText=requestBody,callGraphAPI(HTTP_METHOD.POST,reqEndpoint.value,requestBody,state.accessToken).then(data=>{const responseJson=JSON.stringify(data,null,3);state.dataStore[data.id]=responseJson,responseView.innerText=responseJson,state.currentResource=RESOURCE_TYPE.MESSAGE,state.storeKey=data.id}),httpTab.tabSelecter(0),messageForm.close(),messageEditor.innerHTML=""}),accountInfo.addEventListener("click",e=>{e.target.close()}),copyButton.addEventListener("click",async()=>{await sendClipboard(reqEndpoint.value)}),sendGraphExpButton.addEventListener("click",()=>{const _reqEndpoint=reqEndpoint.value;if(_reqEndpoint){const httpMethod=reqMethod.innerText;sendGraphExporer(httpMethod,_reqEndpoint)}});
